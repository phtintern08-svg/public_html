<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Create New Order â€“ ImpromptuIndian</title>

  <!-- Tailwind (kept for layout utilities) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <link rel="stylesheet" href="css/new-order.css">

  <link rel="shortcut icon" href="../images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="../images/favicon.ico" type="image/x-icon">

  <!-- MapmyIndia SDK - API key will be loaded dynamically from backend -->
  <link rel="stylesheet" id="mappls-css" href="">
  <script id="mappls-script" src=""></script>
  <script>
    // Load Mappls API key from backend and inject into SDK URLs
    (async function() {
      try {
        const token = localStorage.getItem('token');
        if (!token) {
          console.warn('No authentication token found. Map features may not work.');
          return;
        }
        
        const response = await fetch('/api/config', {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });
        
        if (response.ok) {
          const config = await response.json();
          const apiKey = config.mapplsApiKey || '';
          
          if (apiKey) {
            // Update CSS link
            const cssLink = document.getElementById('mappls-css');
            cssLink.href = `https://apis.mappls.com/advancedmaps/api/${apiKey}/map_sdk_plugins/v3.0/mappls.css`;
            
            // Load script
            const script = document.getElementById('mappls-script');
            script.src = `https://apis.mappls.com/advancedmaps/api/${apiKey}/map_sdk?v=3.0&layer=vector&libraries=services`;
            script.onload = () => console.log('Mappls SDK loaded');
            script.onerror = () => console.error('Mappls SDK failed to load');
          } else {
            console.warn('Mappls API key not configured');
          }
        }
      } catch (error) {
        console.error('Failed to load map configuration:', error);
      }
    })();
  </script>
</head>

<body class="antialiased">
  <div class="flex h-screen">

    <!-- SIDEBAR -->
    <div id="sidebar-container"></div>

    <!-- Sidebar Script -->
    <script src="js/sidebar.js"></script>

    <!-- MAIN CONTENT -->
    <main class="flex-1 overflow-y-auto p-8 no-scrollbar">
      <div class="flex items-start justify-between mb-8">
        <div>
          <h1 class="text-3xl font-bold">Create a New Order</h1>
          <p class="text-sm text-gray-400">Fill out the details below to place your order.</p>
        </div>
        <button id="placeOrderBtn" class="place-btn">Place Order</button>
      </div>

      <div class="flex flex-col space-y-8 w-full">

        <!-- PRODUCT DETAILS CARD -->
        <div class="card p-8">
          <h2 class="text-xl font-semibold mb-2 flex items-center gap-2">
            <i data-lucide="shirt" class="w-5 h-5 text-blue-400"></i>
            Product Details
          </h2>
          <p class="text-sm text-gray-400 mb-6">Specify the type of product you want.</p>

          <!-- PRODUCT TYPE -->
          <div class="mb-6">
            <label class="block mb-1 text-sm font-medium">Product Type</label>
            <div class="custom-select" data-name="product-type">
              <select class="blk-input _native-hidden">
                <option value="">Select a product</option>
                <option>T-Shirt</option>
                <option>Hoodie</option>
                <option>Jacket</option>
                <option>Sweatshirt</option>
                <option>Cap</option>
                <option>Shirt</option>
              </select>

              <div class="trigger">
                <span class="value">Select a product</span>
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                  <path d="M6 9l6 6 6-6" stroke="#cbd5e1" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                </svg>
              </div>

              <div class="panel hidden"></div>
            </div>
          </div>

          <!-- CATEGORY -->
          <div class="mb-8">
            <label class="block mb-1 text-sm font-medium">Categories</label>
            <p class="text-sm text-gray-400 mb-3">Choose the style based on product type.</p>
            <div id="categoryContainer" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
          </div>

          <!-- NECK TYPE -->
          <div class="mb-8">
            <label class="block mb-1 text-sm font-medium">Neck Type</label>
            <p class="text-sm text-gray-400 mb-3">Choose a neck/collar style.</p>
            <div id="neckTypeContainer" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
          </div>

          <!-- COLOR / PRINT / FABRIC -->
          <div class="grid md:grid-cols-2 gap-4">
            <!-- COLOR -->
            <div>
              <label class="block mb-1 text-sm font-medium">Color</label>
              <div class="custom-select" data-name="color">
                <select class="blk-input _native-hidden">
                  <option value="">Select a color</option>
                  <option>Black</option>
                  <option>White</option>
                  <option>Blue</option>
                  <option>Red</option>
                </select>

                <div class="trigger">
                  <span class="value">Select a color</span>
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M6 9l6 6 6-6" stroke="#cbd5e1" stroke-width="2" stroke-linecap="round"
                      stroke-linejoin="round" />
                  </svg>
                </div>

                <div class="panel hidden"></div>
              </div>
            </div>

            <!-- PRINT TYPE -->
            <div>
              <label class="block mb-1 text-sm font-medium">Print Type</label>
              <div class="custom-select" data-name="print-type">
                <select class="blk-input _native-hidden">
                  <option value="">Select a print type</option>
                  <option>Screen Print</option>
                  <option>DTG</option>
                  <option>Embroidery</option>
                </select>

                <div class="trigger">
                  <span class="value">Select a print type</span>
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M6 9l6 6 6-6" stroke="#cbd5e1" stroke-width="2" stroke-linecap="round"
                      stroke-linejoin="round" />
                  </svg>
                </div>

                <div class="panel hidden"></div>
              </div>
            </div>

            <!-- FABRIC -->
            <div>
              <label class="block mb-1 text-sm font-medium">Fabric Type</label>
              <div class="custom-select" data-name="fabric-type">
                <select class="blk-input _native-hidden">
                  <option value="">Select a fabric</option>
                  <option>Cotton</option>
                  <option>Polyester</option>
                  <option>Dry Fit</option>
                </select>

                <div class="trigger">
                  <span class="value">Select a fabric</span>
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M6 9l6 6 6-6" stroke="#cbd5e1" stroke-width="2" stroke-linecap="round"
                      stroke-linejoin="round" />
                  </svg>
                </div>

                <div class="panel hidden"></div>
              </div>
            </div>

            <!-- SAMPLE SIZE -->
            <div>
              <label class="block mb-1 text-sm font-medium">Sample Size</label>
              <div class="custom-select" data-name="sample-size">
                <select class="blk-input _native-hidden">
                  <option value="">Select Size</option>
                  <option>S</option>
                  <option>M</option>
                  <option>L</option>
                  <option>XL</option>
                  <option>XXL</option>
                </select>

                <div class="trigger">
                  <span class="value">Select Size</span>
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M6 9l6 6 6-6" stroke="#cbd5e1" stroke-width="2" stroke-linecap="round"
                      stroke-linejoin="round" />
                  </svg>
                </div>

                <div class="panel hidden"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- ADDRESS CARD -->
        <div class="card p-8">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold flex items-center gap-2">
              <i data-lucide="map-pin" class="text-blue-400"></i>
              Delivery & Address
            </h3>

            <button id="useCurrentLocationBtn"
              class="px-3 py-1.5 bg-[#1273EB] hover:bg-[#0e5ac0] text-white text-sm rounded-lg font-semibold flex items-center gap-2">
              <i data-lucide="navigation" class="w-4 h-4"></i>
              Use Current Location
            </button>
          </div>

          <div class="flex gap-3 my-4">
            <button id="btnHome" class="addr-pill">Home</button>
            <button id="btnWork" class="addr-pill">Work</button>
            <button id="btnOther" class="addr-pill">Other</button>
          </div>

          <div class="grid md:grid-cols-2 gap-4">
            <input id="fldHouse" class="blk-input" placeholder="House / Flat No.">
            <input id="fldArea" class="blk-input" placeholder="Area / Street">
            <input id="fldLandmark" class="blk-input" placeholder="Landmark">
            <input id="fldCity" class="blk-input" placeholder="City">
            <input id="fldState" class="blk-input" placeholder="State">
            <input id="fldCountry" class="blk-input" placeholder="Country">
            <input id="fldPincode" class="blk-input" placeholder="Pincode" maxlength="6">
            <input id="fldPhone" class="blk-input" placeholder="Alternative Phone Number">
          </div>

          <div class="mt-4 flex justify-end">
            <button id="saveAddressBtn"
              class="bg-[#FFD43B] text-black px-4 py-2 rounded-lg font-semibold hover:bg-yellow-400 hidden">
              Save Address
            </button>
          </div>
        </div>

        <!-- Additional Details Grid (Quantities + Deadline + File) -->
        <div class="grid md:grid-cols-2 gap-8">
          <!-- QUANTITIES -->
          <div class="card p-8 h-full">
            <h2 class="text-xl font-semibold mb-2">Quantities</h2>

            <label class="text-sm">Total Quantity</label>
            <input id="totalQuantity" class="blk-input" type="number" min="10" max="300">
            <p class="text-xs text-gray-500 mt-1">Min 10 and Max 300</p>

            <!-- PRICE PER PIECE (CUSTOMER OFFER) -->
            <div class="mt-4">
              <label class="text-sm font-medium">Price Per Piece (Your Offer)</label>
              <input id="pricePerPiece" type="number" class="blk-input" placeholder="Enter price per piece">
              <p class="text-xs text-gray-500 mt-1">Vendors will see this offered price.</p>
            </div>

            <hr class="my-4">

            <div class="grid gap-3">
              <div class="flex justify-between"><span>S</span><input data-size="S"
                  class="qty-input blk-input w-24 text-right" value="10" type="number"></div>
              <div class="flex justify-between"><span>M</span><input data-size="M"
                  class="qty-input blk-input w-24 text-right" value="0" type="number"></div>
              <div class="flex justify-between"><span>L</span><input data-size="L"
                  class="qty-input blk-input w-24 text-right" value="0" type="number"></div>
              <div class="flex justify-between"><span>XL</span><input data-size="XL"
                  class="qty-input blk-input w-24 text-right" value="0" type="number"></div>
              <div class="flex justify-between"><span>XXL</span><input data-size="XXL"
                  class="qty-input blk-input w-24 text-right" value="0" type="number"></div>

              <p class="text-right"><span id="sizeSum" class="text-green-400">10</span></p>
            </div>
          </div>

          <!-- RIGHT COLUMN: Deadline + File -->
          <div class="flex flex-col gap-8 h-full">
            <!-- DELIVERY DEADLINE -->
            <div class="card p-8 flex-1">
              <h2 class="text-xl font-semibold mb-2">Delivery Deadline</h2>

              <button id="dateBtn" class="flex items-center justify-between w-full" type="button">
                <span id="dateText">Pick a date</span>
                <i data-lucide="calendar" class="w-5 h-5"></i>
              </button>

              <!-- Calendar logic handles the popup ID 'calendar' which is moved to body by JS -->
              <div id="calendar" class="calendar-popup hidden" role="dialog">
                <div class="head">
                  <button id="prevMonth" class="icon-btn"><i data-lucide="chevron-left"></i></button>
                  <div id="monthLabel">Month</div>
                  <button id="nextMonth" class="icon-btn"><i data-lucide="chevron-right"></i></button>
                </div>

                <div class="dow">
                  <div>Su</div>
                  <div>Mo</div>
                  <div>Tu</div>
                  <div>We</div>
                  <div>Th</div>
                  <div>Fr</div>
                  <div>Sa</div>
                </div>

                <div id="daysGrid" class="cal-grid"></div>
              </div>

              <p class="text-xs text-gray-500 mt-3">Minimum of 2 days is required.</p>
            </div>

            <!-- FILE UPLOAD -->
            <div class="card p-8 flex-1">
              <h2 class="text-xl font-semibold mb-2">Design Reference</h2>
              <label for="file" class="file-label" id="fileLabel">
                <i data-lucide="image" class="w-4 h-4"></i>
                <span class="filename">Choose File</span>
                <input id="file" class="hidden" type="file" accept="image/*">
              </label>

              <!-- Placement Options (Hidden by default) -->
              <div id="placementOptions" class="hidden mt-4">
                <label class="block mb-2 text-sm font-medium">Placement</label>
                <div class="flex gap-2">
                  <button class="placement-btn active" data-place="front">Front</button>
                  <button class="placement-btn" data-place="back">Back</button>
                  <button class="placement-btn" data-place="left_sleeve">L. Sleeve</button>
                  <button class="placement-btn" data-place="right_sleeve">R. Sleeve</button>
                </div>
              </div>

              <button id="viewModelBtn"
                class="w-full mt-4 bg-blue-600 hover:bg-blue-500 text-white py-2 rounded-lg font-semibold hidden">
                View How It Looks
              </button>
            </div>
          </div>
        </div>

      </div>
    </main>
  </div>

  <!-- 3D VIEWER OVERLAY -->
  <div id="viewerSection" class="fixed inset-0 z-50 bg-black bg-opacity-90 hidden flex items-center justify-center">
    <div class="relative w-full max-w-4xl h-[80vh] bg-[#0f1722] rounded-2xl overflow-hidden border border-gray-800">
      <button onclick="document.getElementById('viewerSection').classList.add('hidden')"
        class="absolute top-4 right-4 z-10 p-2 bg-gray-800 rounded-full hover:bg-gray-700 text-white">
        <i data-lucide="x" class="w-6 h-6"></i>
      </button>
      <div id="viewerContainer" class="w-full h-full"></div>
    </div>
  </div>

  <!-- Leaflet CSS & JS deleted -->

  <!-- ALERT MODAL -->
  <div id="customAlert" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden z-50 px-4">
    <div class="bg-[#0f131a] border border-gray-800 rounded-xl p-6 shadow-2xl text-white max-w-sm w-full">
      <div class="flex flex-col items-center text-center">
        <div id="alertIcon" class="mb-4"></div>
        <h3 id="alertTitle" class="text-lg font-bold mb-2">Alert</h3>
        <p id="alertMessage" class="text-gray-400 text-sm mb-6">Message goes here</p>

        <div class="flex gap-3 w-full">
          <button id="alertCancelBtn" onclick="closeAlert()"
            class="hidden w-full bg-gray-600 hover:bg-gray-500 text-white py-2 rounded-md font-medium">Cancel</button>

          <button id="alertOkBtn" onclick="closeAlert()"
            class="w-full bg-[#3fa9ff] hover:bg-[#2d93e0] text-white py-2 rounded-md font-medium">Okay</button>
        </div>
      </div>
    </div>
  </div>

  <!-- PAYMENT MODAL (Gateway Style) -->
  <div id="paymentModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-90 hidden z-50 px-4">
    <div
      class="bg-[#0f131a] border border-gray-800 rounded-xl w-full max-w-4xl h-[600px] flex shadow-2xl overflow-hidden relative">

      <!-- Close Button -->
      <button onclick="document.getElementById('paymentModal').classList.add('hidden')"
        class="absolute top-4 right-4 text-gray-400 hover:text-white z-10">
        <i data-lucide="x" class="w-6 h-6"></i>
      </button>

      <!-- LEFT SIDEBAR: Payment Methods -->
      <div class="w-1/3 bg-[#161b22] border-r border-gray-800 flex flex-col">
        <div class="p-4 border-b border-gray-800">
          <h3 class="text-white font-semibold flex items-center gap-2">
            <i data-lucide="wallet" class="text-blue-500"></i> Payment Options
          </h3>
        </div>

        <div class="flex-1 overflow-y-auto" style="scrollbar-width: none; -ms-overflow-style: none;">
          <style>
            .flex-1::-webkit-scrollbar {
              display: none;
            }
          </style>
          <button
            class="w-full text-left px-6 py-4 text-sm font-medium text-blue-400 bg-blue-900/10 border-l-4 border-blue-500 hover:bg-gray-800 transition-colors"
            id="tab-card" onclick="switchPaymentTab('card')">
            <div class="flex items-center gap-3">
              <i data-lucide="credit-card" class="w-5 h-5"></i>
              Credit / Debit / ATM Card
            </div>
          </button>

          <button
            class="w-full text-left px-6 py-4 text-sm font-medium text-gray-400 border-l-4 border-transparent hover:bg-gray-800 hover:text-white transition-colors"
            id="tab-upi" onclick="switchPaymentTab('upi')">
            <div class="flex items-center gap-3">
              <i data-lucide="smartphone" class="w-5 h-5"></i>
              UPI (PhonePe, GPay)
            </div>
          </button>

          <button
            class="w-full text-left px-6 py-4 text-sm font-medium text-gray-400 border-l-4 border-transparent hover:bg-gray-800 hover:text-white transition-colors"
            id="tab-netbanking" onclick="switchPaymentTab('netbanking')">
            <div class="flex items-center gap-3">
              <i data-lucide="landmark" class="w-5 h-5"></i>
              Net Banking
            </div>
          </button>

          <button
            class="w-full text-left px-6 py-4 text-sm font-medium text-gray-400 border-l-4 border-transparent hover:bg-gray-800 hover:text-white transition-colors"
            id="tab-cod" onclick="switchPaymentTab('cod')">
            <div class="flex items-center gap-3">
              <i data-lucide="banknote" class="w-5 h-5"></i>
              Cash on Delivery
            </div>
          </button>
        </div>

        <div class="p-4 bg-gray-900/50 text-xs text-gray-500 border-t border-gray-800">
          100% Secure Payments powered by ImpromptuIndian
        </div>
      </div>

      <!-- RIGHT CONTENT: Forms & Summary -->
      <div class="w-2/3 bg-[#0f131a] flex flex-col relative">

        <!-- DYNAMIC CONTENT AREA -->
        <div class="flex-1 p-8 overflow-y-auto pb-32" style="scrollbar-width: none; -ms-overflow-style: none;">
          <style>
            .overflow-y-auto::-webkit-scrollbar {
              display: none;
            }
          </style>

          <!-- SUMMARY CARD (Always Visible) -->
          <div class="mb-8 p-4 bg-gray-800/30 rounded-lg border border-gray-700">
            <h4 class="text-sm font-semibold text-gray-300 mb-3 uppercase tracking-wider">Order Summary</h4>

            <div class="flex justify-between items-center mb-2">
              <span class="text-gray-400 text-sm">Sample Size</span>
              <!-- Sample Size Selection Inside Gateway -->
              <div class="custom-select w-24 h-8" data-name="modal-sample-size">
                <select class="blk-input _native-hidden" id="modalSampleSizeSelect">
                  <option value="">Size</option>
                  <option>S</option>
                  <option>M</option>
                  <option>L</option>
                  <option>XL</option>
                  <option>XXL</option>
                </select>
                <div class="trigger bg-gray-900 border-gray-600 py-1 text-xs">
                  <span class="value">Size</span>
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                    <path d="M6 9l6 6 6-6" stroke="#cbd5e1" stroke-width="2" stroke-linecap="round"
                      stroke-linejoin="round" />
                  </svg>
                </div>
                <div class="panel hidden bg-gray-900 border-gray-600 text-xs"></div>
              </div>
            </div>

            <div class="flex justify-between items-center mb-1">
              <span class="text-gray-400 text-sm">Sample Cost</span>
              <span id="gatewaySampleCost" class="text-white font-medium">--</span>
            </div>
            <div class="flex justify-between items-center mb-1">
              <span class="text-gray-400 text-sm">Delivery Fee</span>
              <span class="text-green-400 font-medium font-xs">FREE</span>
            </div>
            <div class="border-t border-gray-700 my-2 pt-2 flex justify-between items-center">
              <span class="text-white font-bold">Total Amount Payable</span>
              <span id="gatewayTotalPayable" class="text-xl font-bold text-[#FFCC00]">--</span>
            </div>
            <p class="text-xs text-gray-500 mt-2">
              * Estimated total for bulk order: <span id="gatewayEstTotalCost" class="text-gray-400">--</span>
            </p>
          </div>

          <!-- CARD PAYMENT FORM -->
          <div id="view-card" class="payment-view">
            <h4 class="text-lg font-bold text-white mb-4">Enter Card Details</h4>

            <div class="space-y-4">
              <div>
                <input type="text" id="cardNumber" placeholder="Card Number" maxlength="19"
                  class="w-full bg-gray-900 border border-gray-700 text-white rounded p-3 focus:outline-none focus:border-blue-500 transition-colors">
              </div>
              <div class="grid grid-cols-2 gap-4">
                <input type="text" id="cardExpiry" placeholder="Valid Thru (MM/YY)" maxlength="5"
                  class="bg-gray-900 border border-gray-700 text-white rounded p-3 focus:outline-none focus:border-blue-500 transition-colors">
                <input type="password" id="cardCvv" placeholder="CVV" maxlength="3"
                  class="bg-gray-900 border border-gray-700 text-white rounded p-3 focus:outline-none focus:border-blue-500 transition-colors">
              </div>
              <div>
                <input type="text" id="cardName" placeholder="Name on Card"
                  class="w-full bg-gray-900 border border-gray-700 text-white rounded p-3 focus:outline-none focus:border-blue-500 transition-colors">
              </div>
            </div>

            <button id="btnPayCard"
              class="mt-6 w-full bg-[#FFCC00] hover:bg-[#ffdb4d] text-black font-bold py-3.5 rounded shadow-lg transition-transform active:scale-[0.98]">
              Pay <span class="pay-amount-display">--</span>
            </button>
          </div>

          <!-- UPI FORM -->
          <div id="view-upi" class="payment-view hidden">
            <h4 class="text-lg font-bold text-white mb-4">UPI Payment</h4>
            <div class="space-y-4">
              <div class="bg-white p-4 rounded-lg flex justify-center mb-4">
                <!-- Placeholder QR -->
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=ImpromptuIndianSamplePayment"
                  alt="UPI QR" class="opacity-90">
              </div>
              <div class="text-center text-sm text-gray-400 mb-4">Scan QR with any UPI App</div>

              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">@</div>
                <input type="text" id="upiId" placeholder="Enter UPI ID"
                  class="w-full bg-gray-900 border border-gray-700 text-white rounded p-3 pl-8 focus:outline-none focus:border-blue-500">
              </div>
              <button id="btnPayUpi"
                class="w-full bg-[#FFCC00] hover:bg-[#ffdb4d] text-black font-bold py-3.5 rounded shadow-lg transition-transform active:scale-[0.98]">
                Verify & Pay <span class="pay-amount-display">--</span>
              </button>
            </div>
          </div>

          <!-- OTHER VIEWS (NetBanking / COD) -->
          <div id="view-netbanking" class="payment-view hidden">
            <div class="flex flex-col items-center justify-center h-40 text-gray-500">
              <i data-lucide="wrench" class="w-8 h-8 mb-2"></i>
              <p>Net Banking banks will be listed here.</p>
            </div>
          </div>

          <div id="view-cod" class="payment-view hidden">
            <div class="bg-red-900/20 border border-red-500/30 p-4 rounded text-red-400 flex items-start gap-3">
              <i data-lucide="alert-circle" class="w-5 h-5 flex-shrink-0 mt-0.5"></i>
              <p class="text-sm">Cash on Delivery is <b>not available</b> for sample orders. Please pay online to
                confirm your production sample.</p>
            </div>
          </div>

        </div>

      </div>
    </div>
  </div>

  <!-- MAP MODAL -->
  <div id="mapModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-80 hidden z-50 px-4">
    <div
      class="bg-[#0f131a] border border-gray-800 rounded-xl overflow-hidden shadow-2xl w-full max-w-2xl h-[600px] flex flex-col">
      <div class="p-4 border-b border-gray-800 flex justify-between items-center bg-[#161b22]">
        <div>
          <h3 class="text-lg font-semibold text-white">Confirm Location</h3>
          <p class="text-xs text-yellow-500 mt-1">
            <i data-lucide="info" class="w-3 h-3 inline mr-1"></i>
            Location is approximate. Drag pin or search below.
          </p>
        </div>
        <button onclick="document.getElementById('mapModal').classList.add('hidden')"
          class="text-gray-400 hover:text-white">
          <i data-lucide="x" class="w-5 h-5"></i>
        </button>
      </div>

      <!-- Search Bar Inside Modal -->
      <div class="px-4 py-2 border-b border-gray-800 bg-[#161b22] flex gap-2">
        <input type="text" id="mapSearchInput" placeholder="Search for your city/area..."
          class="flex-1 bg-gray-900 border border-gray-700 text-white rounded px-3 py-1 focus:outline-none focus:border-blue-500">
        <button id="mapSearchBtn"
          class="bg-blue-600 hover:bg-blue-500 text-white px-3 py-1 rounded text-sm font-medium">Search</button>
      </div>

      <div id="mapContainer" class="flex-1 w-full bg-gray-900 relative"></div>
      <div class="p-4 border-t border-gray-800 bg-[#161b22] flex justify-end gap-3">
        <button onclick="document.getElementById('mapModal').classList.add('hidden')"
          class="px-4 py-2 text-gray-300 hover:text-white font-medium">Cancel</button>
        <button id="confirmLocationBtn"
          class="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg font-medium">Confirm Location</button>
      </div>
    </div>
  </div>

  <!-- SCRIPTS (RUN ONLY AFTER PAGE LOADS) -->
  <script src="js/custom-alert.js"></script>
  <script src="js/location-service.js"></script>
  <script src="../js/fake-payment-gateway.js"></script>

  <script>
    /* Ensure new-order.js runs only after DOM is ready */
    document.addEventListener("DOMContentLoaded", () => {
      const script = document.createElement("script");
      script.src = "js/new-order.js";
      document.body.appendChild(script);
    });
  </script>

</body>

</html>